{"priority": "major", "kind": "bug", "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo9-release.json"}, "html": {"href": "#!/osrf/gazebo9-release"}, "avatar": {"href": "data/bytebucket.org/ravatar/{5487cdc4-c60e-4fa1-bbbc-871d5f56b0e8}ts=default"}}, "type": "repository", "name": "gazebo9-release", "full_name": "osrf/gazebo9-release", "uuid": "{5487cdc4-c60e-4fa1-bbbc-871d5f56b0e8}"}, "links": {"attachments": {"href": "data/repositories/osrf/gazebo9-release/issues/2/attachments_page=1.json"}, "self": {"href": "data/repositories/osrf/gazebo9-release/issues/2.json"}, "watch": {"href": "https://api.bitbucket.org/2.0/repositories/osrf/gazebo9-release/issues/2/watch"}, "comments": {"href": "data/repositories/osrf/gazebo9-release/issues/2/comments_page=1.json"}, "html": {"href": "#!/osrf/gazebo9-release/issues/2/gz-sdf-converter-fails-due-to-socket"}, "vote": {"href": "https://api.bitbucket.org/2.0/repositories/osrf/gazebo9-release/issues/2/vote"}}, "reporter": {"display_name": "Tully Foote", "uuid": "{3d90dbd4-b845-466f-b5bd-068566f7ff50}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B3d90dbd4-b845-466f-b5bd-068566f7ff50%7D"}, "html": {"href": "https://bitbucket.org/%7B3d90dbd4-b845-466f-b5bd-068566f7ff50%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/3bc6528f8fe1fef6b6ecc7312ee0cf04d=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsTF-2.png"}}, "nickname": "Tully Foote", "type": "user", "account_id": "557058:e2bf789f-2138-4a4e-ba39-3d618078e20b"}, "title": "gz sdf converter fails due to socket issues", "component": null, "votes": 0, "watches": 1, "content": {"raw": "From: https://github.com/ros/rosdistro/pull/19696#issuecomment-449377288\r\n\r\nCommand\r\n```\r\ncd /tmp/binarydeb/ros-melodic-rotors-gazebo-2.2.3 && gz sdf -p /tmp/binarydeb/ros-melodic-rotors-gazebo-2.2.3/models/rotors_description/urdf/iris_base.urdf >> /tmp/binarydeb/ros-melodic-rotors-gazebo-2.2.3/models/iris/iris.sdf\r\n```\r\n\r\nfails with\r\n```\r\n09:43:54 Unsupported setsockopt level=0 optname=32\r\n09:43:54 Error setting socket option (IP_MULTICAST_IF).\r\n09:43:54 Unsupported setsockopt level=0 optname=32\r\n09:43:54 Error setting socket option (IP_MULTICAST_IF).\r\n09:43:54 Did you set the environment variable IGN_IP with a correct IP address? \r\n09:43:54   [172.30.1.33] seems an invalid local IP address.\r\n09:43:54   Using 127.0.0.1 as hostname.\r\n09:43:54 Unsupported setsockopt level=0 optname=32\r\n09:43:54 Error setting socket option (IP_MULTICAST_IF).\r\n09:43:54 terminate called after throwing an instance of 'std::out_of_range'\r\n09:43:54   what():  vector::_M_range_check: __n (which is 0) >= this->size() (which is 0)\r\n```\r\n\r\nwhich seems to be a known issue in ignition when used in Linux for Windows subsystem, but the cause might be similar on ARM Linux Kernels (not being aple to set IP_MULTICAST_IF on that socket - because it seems to be the wrong socket, not local loopback). See also https://bitbucket.org/osrf/gazebo/issues/2351/gazebo-issues-on-windows-subsystem-for\r\n\r\nBut I guess that is something build-system related that doesn't have much to do with our code, or whats your take on this?\r\n\r\nIn any case, thanks much for your support and merry christmas ;-)\r\n\r\n---\r\nThe socket issue is likely related to our builds being run inside of docker with limited permissions. There might be something to do to make ignition-transport more robust to that, but in this case it looks like it shouldn't even be opening a socket if it's just converting a urdf to sdf.", "markup": "markdown", "html": "<p>From: <a href=\"https://github.com/ros/rosdistro/pull/19696#issuecomment-449377288\" rel=\"nofollow\" class=\"ap-connect-link\">https://github.com/ros/rosdistro/pull/19696#issuecomment-449377288</a></p>\n<p>Command</p>\n<div class=\"codehilite\"><pre><span></span>cd /tmp/binarydeb/ros-melodic-rotors-gazebo-2.2.3 &amp;&amp; gz sdf -p /tmp/binarydeb/ros-melodic-rotors-gazebo-2.2.3/models/rotors_description/urdf/iris_base.urdf &gt;&gt; /tmp/binarydeb/ros-melodic-rotors-gazebo-2.2.3/models/iris/iris.sdf\n</pre></div>\n\n\n<p>fails with</p>\n<div class=\"codehilite\"><pre><span></span><span class=\"mi\">09</span><span class=\"o\">:</span><span class=\"mi\">43</span><span class=\"o\">:</span><span class=\"mi\">54</span> <span class=\"n\">Unsupported</span> <span class=\"n\">setsockopt</span> <span class=\"n\">level</span><span class=\"o\">=</span><span class=\"mi\">0</span> <span class=\"n\">optname</span><span class=\"o\">=</span><span class=\"mi\">32</span>\n<span class=\"mi\">09</span><span class=\"o\">:</span><span class=\"mi\">43</span><span class=\"o\">:</span><span class=\"mi\">54</span> <span class=\"n\">Error</span> <span class=\"n\">setting</span> <span class=\"n\">socket</span> <span class=\"n\">option</span> <span class=\"o\">(</span><span class=\"n\">IP_MULTICAST_IF</span><span class=\"o\">).</span>\n<span class=\"mi\">09</span><span class=\"o\">:</span><span class=\"mi\">43</span><span class=\"o\">:</span><span class=\"mi\">54</span> <span class=\"n\">Unsupported</span> <span class=\"n\">setsockopt</span> <span class=\"n\">level</span><span class=\"o\">=</span><span class=\"mi\">0</span> <span class=\"n\">optname</span><span class=\"o\">=</span><span class=\"mi\">32</span>\n<span class=\"mi\">09</span><span class=\"o\">:</span><span class=\"mi\">43</span><span class=\"o\">:</span><span class=\"mi\">54</span> <span class=\"n\">Error</span> <span class=\"n\">setting</span> <span class=\"n\">socket</span> <span class=\"n\">option</span> <span class=\"o\">(</span><span class=\"n\">IP_MULTICAST_IF</span><span class=\"o\">).</span>\n<span class=\"mi\">09</span><span class=\"o\">:</span><span class=\"mi\">43</span><span class=\"o\">:</span><span class=\"mi\">54</span> <span class=\"n\">Did</span> <span class=\"n\">you</span> <span class=\"kd\">set</span> <span class=\"n\">the</span> <span class=\"n\">environment</span> <span class=\"n\">variable</span> <span class=\"n\">IGN_IP</span> <span class=\"k\">with</span> <span class=\"n\">a</span> <span class=\"n\">correct</span> <span class=\"n\">IP</span> <span class=\"n\">address</span><span class=\"o\">?</span> \n<span class=\"mi\">09</span><span class=\"o\">:</span><span class=\"mi\">43</span><span class=\"o\">:</span><span class=\"mi\">54</span>   <span class=\"o\">[</span><span class=\"mf\">172.30</span><span class=\"o\">.</span><span class=\"mf\">1.33</span><span class=\"o\">]</span> <span class=\"n\">seems</span> <span class=\"n\">an</span> <span class=\"n\">invalid</span> <span class=\"n\">local</span> <span class=\"n\">IP</span> <span class=\"n\">address</span><span class=\"o\">.</span>\n<span class=\"mi\">09</span><span class=\"o\">:</span><span class=\"mi\">43</span><span class=\"o\">:</span><span class=\"mi\">54</span>   <span class=\"n\">Using</span> <span class=\"mf\">127.0</span><span class=\"o\">.</span><span class=\"mf\">0.1</span> <span class=\"k\">as</span> <span class=\"n\">hostname</span><span class=\"o\">.</span>\n<span class=\"mi\">09</span><span class=\"o\">:</span><span class=\"mi\">43</span><span class=\"o\">:</span><span class=\"mi\">54</span> <span class=\"n\">Unsupported</span> <span class=\"n\">setsockopt</span> <span class=\"n\">level</span><span class=\"o\">=</span><span class=\"mi\">0</span> <span class=\"n\">optname</span><span class=\"o\">=</span><span class=\"mi\">32</span>\n<span class=\"mi\">09</span><span class=\"o\">:</span><span class=\"mi\">43</span><span class=\"o\">:</span><span class=\"mi\">54</span> <span class=\"n\">Error</span> <span class=\"n\">setting</span> <span class=\"n\">socket</span> <span class=\"n\">option</span> <span class=\"o\">(</span><span class=\"n\">IP_MULTICAST_IF</span><span class=\"o\">).</span>\n<span class=\"mi\">09</span><span class=\"o\">:</span><span class=\"mi\">43</span><span class=\"o\">:</span><span class=\"mi\">54</span> <span class=\"n\">terminate</span> <span class=\"n\">called</span> <span class=\"n\">after</span> <span class=\"n\">throwing</span> <span class=\"n\">an</span> <span class=\"n\">instance</span> <span class=\"n\">of</span> <span class=\"s1\">&#39;std::out_of_range&#39;</span>\n<span class=\"mi\">09</span><span class=\"o\">:</span><span class=\"mi\">43</span><span class=\"o\">:</span><span class=\"mi\">54</span>   <span class=\"n\">what</span><span class=\"o\">():</span>  <span class=\"n\">vector</span><span class=\"o\">::</span><span class=\"n\">_M_range_check</span><span class=\"o\">:</span> <span class=\"n\">__n</span> <span class=\"o\">(</span><span class=\"n\">which</span> <span class=\"k\">is</span> <span class=\"mi\">0</span><span class=\"o\">)</span> <span class=\"o\">&gt;=</span> <span class=\"k\">this</span><span class=\"o\">-&gt;</span><span class=\"n\">size</span><span class=\"o\">()</span> <span class=\"o\">(</span><span class=\"n\">which</span> <span class=\"k\">is</span> <span class=\"mi\">0</span><span class=\"o\">)</span>\n</pre></div>\n\n\n<p>which seems to be a known issue in ignition when used in Linux for Windows subsystem, but the cause might be similar on ARM Linux Kernels (not being aple to set IP_MULTICAST_IF on that socket - because it seems to be the wrong socket, not local loopback). See also <a href=\"https://bitbucket.org/osrf/gazebo/issues/2351/gazebo-issues-on-windows-subsystem-for\" rel=\"nofollow\" class=\"ap-connect-link\">https://bitbucket.org/osrf/gazebo/issues/2351/gazebo-issues-on-windows-subsystem-for</a></p>\n<p>But I guess that is something build-system related that doesn't have much to do with our code, or whats your take on this?</p>\n<p>In any case, thanks much for your support and merry christmas ;-)</p>\n<hr />\n<p>The socket issue is likely related to our builds being run inside of docker with limited permissions. There might be something to do to make ignition-transport more robust to that, but in this case it looks like it shouldn't even be opening a socket if it's just converting a urdf to sdf.</p>", "type": "rendered"}, "assignee": null, "state": "new", "version": null, "edited_on": null, "created_on": "2019-01-02T23:48:51.378691+00:00", "milestone": null, "updated_on": "2019-01-03T17:16:38.110832+00:00", "type": "issue", "id": 2}